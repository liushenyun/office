<!DOCTYPE html>
<html lang="en" style="font-size: 75px">
<head>
    <meta charset="utf-8"> 
    <!--允许全屏--> 
    <meta content="yes" name="apple-mobile-web-app-capable"> 
    <meta content="yes" name="apple-touch-fullscreen"> 
    <meta content="telephone=no,email=no" name="format-detection"> 
    <title>503会议室</title>
    <link rel="stylesheet" href="./lib/reset.css">
    <link rel="stylesheet" href="./lib/office.css">
    <script src="./lib/jquery-3.4.1.min.js"></script>
    <script src='./lib/flexible.js'></script>
    <style>
        body,
        html {
            color: #333;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="office-container">
        <div class="time-outer">
            <div class="time-wrap">
                <div class="status-title">目前状态</div>
                <div class="status-title">实际空闲</div>
                <div class="time-inner">
                    <div class="status-x">
                        <ul class="office-yu-ul">
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                        </ul>
                    </div>
                    <ul class="status-x-time">
                        <li>8:00</li>
                        <li>8:30</li>
                        <li>9:00</li>
                        <li>9:30</li>
                        <li>10:00</li>
                        <li>10:30</li>
                        <li>11:00</li>
                        <li>11:30</li>
                        <li>12:00</li>
                        <li>12:30</li>
                        <li>13:00</li>
                        <li>13:30</li>
                        <li>14:00</li>
                        <li>14:30</li>
                        <li>15:00</li>
                        <li>15:30</li>
                        <li>16:00</li>
                        <li>16:30</li>
                        <li>17:00</li>
                        <li>18:30</li>
                        <li>19:00</li>
                        <li>19:30</li>
                        <li>20:00</li>
                        <li>20:30</li>
                    </ul>
                    <div class="status-x x-1">
                        <ul>
                           
                        </ul>
                    </div>
                    <ul class="status-x-time">
                        <li>8:00</li>
                        <li>8:30</li>
                        <li>9:00</li>
                        <li>9:30</li>
                        <li>10:00</li>
                        <li>10:30</li>
                        <li>11:00</li>
                        <li>11:30</li>
                        <li>12:00</li>
                        <li>12:30</li>
                        <li>13:00</li>
                        <li>13:30</li>
                        <li>14:00</li>
                        <li>14:30</li>
                        <li>15:00</li>
                        <li>15:30</li>
                        <li>16:00</li>
                        <li>16:30</li>
                        <li>17:00</li>
                        <li>18:30</li>
                        <li>19:00</li>
                        <li>19:30</li>
                        <li>20:00</li>
                        <li>20:30</li>
                    </ul>
                </div>
            </div>

            <div class="status-des-outer">
                <span>
                    <div style="background: #7BD460" class="co"></div>
                    <div>已预订</div>
                </span>
                <span>
                    <div style="background: #FFD119" class="co"></div>
                    <div>已预订未审批</div>
                </span> 
                <span>
                    <div style="background: #CCC" class="co"></div>
                    <div>未预订</div>
                </span>
                <span>
                    <div style="background: #34A1FC" class="co"></div>
                    <div>实际占用</div>
                </span>
            </div>
        </div>
    </div>
    <script src='./lib/tools.js'></script>
    <script>
            $(function() {
                var Page = {
                    const: {
                        pageParams: {
                            officeSite: '',
                            officeCode: '',
                            date: ''
                        }
                    },
                    init: function() {
                        var _serach = Tools.getSearch()
                        Page.const.pageParams.date = Tools.dateFormat(new Date(), 'yyyy-MM-dd')
                        Page.const.pageParams.officeSite = _serach.officeSite
                        Page.const.pageParams.officeCode = _serach.officeCode
                        document.title = _serach.officeCode + '会议室'
                        this.getData()
                    },
                    getData: function() {
                        Tools.request({
                            url: Tools.constant.apiOfficeDetail,
                            type: 'GET',
                            data: Page.const.pageParams
                        }, function(msg) {
                            console.log(msg);
                            if (msg.status != "success") {
                                return
                            }
                            var _actualInfoList = msg.data.actualInfoList || []
                            function getDistance(beginTime, endTime) {
                                var _date = Tools.dateFormat(new Date(beginTime), 'yyyy-MM-dd')
                                console.log(beginTime, endTime, _date)
                                var _disStart = new Date(beginTime).getTime() - new Date(_date + ' 08:00').getTime()
                                var _disEnd = new Date(endTime).getTime() - new Date(_date + ' 08:00').getTime()
                                return [_disStart/60/1000, _disEnd/60/1000]
                            }
                            // var _actualInfoList = [
                            //     { beginTime: '08:00', endTime: '08:00' },
                            //     { beginTime: '08:36', endTime: '08:40' },
                            //     { beginTime: '09:52', endTime: '10:10' }
                            // ]

                            _actualInfoList.forEach(function(val) {
                                if (val && val.beginTime) {
                                    val.timeArr = getDistance(val.beginTime, val.endTime)
                                }
                            })
                            var _str = ''
                            for (var index = 0; index < 720; index++) {
                                var _flag = false
                                for (var i = 0, len = _actualInfoList.length; i < len; i++) {
                                    if (_actualInfoList[i] && _actualInfoList[i].timeArr) {
                                        var _timeArr = _actualInfoList[i].timeArr
                                        if (_timeArr[0]<=index && index <=_timeArr[1]) {
                                            _flag = true
                                            break
                                        }
                                    }
                                }
                                
                                if (_flag) {
                                    _str += '<li class="on"></li>'
                                } else {
                                    _str += '<li class="off"></li>'
                                }
                            }
                            $('.x-1 ul').html(_str)
                        })
                    }
                }
                Page.init()
            })
        </script>
</body>
</html>